#!/bin/bash
sudo cp /opt/bitnami/nginx/conf/bitnami/certs/server.crt /opt/bitnami/nginx/conf/bitnami/certs/server.crt.bak
sudo cp /opt/bitnami/nginx/conf/bitnami/certs/server.key /opt/bitnami/nginx/conf/bitnami/certs/server.key.bak
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
#
sudo sed -i 's/^PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
sudo rm -f /etc/ssh/sshd_not_to_be_run
sudo systemctl enable ssh
sudo systemctl start ssh
#
sudo sed -i 's/^listen 80/# listen 80/' /opt/bitnami/nginx/conf/nginx.conf
keytext='-----BEGIN PRIVATE KEY-----
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
h/fRcP2vzzZhr+6yH5I0pvDWAlGPlQqI
-----END PRIVATE KEY-----'
certtext='-----BEGIN CERTIFICATE-----
MIIGCDCCA/CgAwIBAgIUXJocaCGUoFODQiBe0ARH/WARvw0wDQYJKoZIhvcNAQEN
BQAwYzELMAkGA1UEBhMCQ04xDjAMBgNVBAgMBUluZGlhMQ4wDAYDVQQHDAVJbmRp
YTEQMA4GA1UECgwHZXhhbXBsZTERMA8GA1UECwwIUGVyc29uYWwxDzANBgNVBAMM
BmhhcmJvcjAeFw0yNTAxMjIwNzMyMzhaFw0zNTAxMjAwNzMyMzhaMHoxCzAJBgNV
BAYTAkNOMRAwDgYDVQQIDAdCZWlqaW5nMRAwDgYDVQQHDAdCZWlqaW5nMRAwDgYD
VQQKDAdleGFtcGxlMREwDwYDVQQLDAhQZXJzb25hbDEiMCAGA1UEAwwZaGFyYm9y
bG9jYWwuY29ycC5pbnRlcm5hbDCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoC
ggIBANc9bPiArWpbcrQ4VO48ee4IlpNO7gcPxmrQdTvXEIV1G9e1CtGARQ6iS9ws
OWYsyjCPUP6Q85ludwpNCFDtoPCXCHoTgM1QgrePcHq4xghP1n5eGHmP07JcGAl4
u5BtT3kiDR4IguQx28LuPfbfJRxXijYmNyevJg9V7Tml9LQRpPqXNzF+2Qa3zF2k
tlBQfxepVwWKQb0+NV8Mdeq3DpxjZJXKIgZ3X5j9jU63Dio1tM2WdF5lpSu7hjzb
MeaBjFDZLf9dn48RTviODLhxnH92FZEA/yaGoF4ME4J1NhlUel0e/g/KKTmtvcIM
OvHAPViF59JIHf/VkNmfNzkAMBLKETJuCqAcSCh5Bjn/ih3GEa3EImW7AesNzenP
kW6J59d3TjyHrV/ws4px2PybG7U69w9zkANYi9r5qWhqSA2RHtsC/eQfwFxwWyxx
bex69ItjlMAVEZ2h4gRFOfGelVJyhfYsGA1cQohkmjbaEZ9pMMY+Y8ZSVDbvzsVD
ANzyXpdYAv8NMAas4ZW/DMWIGkFlTzQZV5bg3VKYdnUmTGEKM8tUypKIp6120dYJ
sqQyorfMgUuulmdWMGAk41MSBJX99H0MF1Javzn6tME3HARTQysHwmKa/hIlpdtx
he66xkkj1QUxKlYlzvzrDleFsXqdPpQRr0+muB5ruRP0i0u5AgMBAAGjgZwwgZkw
HwYDVR0jBBgwFoAUiJRn/vIAYR4oxdZd2u0ml6oqEKYwCQYDVR0TBAIwADALBgNV
HQ8EBAMCBPAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwKgYDVR0RBCMwIYIZaGFyYm9y
bG9jYWwuY29ycC5pbnRlcm5hbIcErBAKCjAdBgNVHQ4EFgQUaiTdnjYh+R00dLRK
OnbpPFlI5RUwDQYJKoZIhvcNAQENBQADggIBAMMgIPNlyXd84ucF/KLu/fhPr06h
jRgvJi/XsYWROvRwdB9PVv4DhcIpNcvXu3gDrlaMB/N4xyRKbXNOPvNkkZFfj7eb
9RSjojtmYTb/gn5kGCIyX/YnQFycCEJo8tu2u54NhtSJJlDUEC3wzJJSevBPb8Tk
0RHoKYsWwRllAmdKopUIA3IOdLr6XGrYJ1WGtqB1H+8ziPaD9GAdbKcQHXU5Y5lH
CrjeehU5vG+3G+PfEut9KZsk/pErCuxP2xpeFq4mSQ7c93c2ABA4BuoiljbnJyGZ
4pESH4ZogQjgY43V7609Y4+tA07Afi/yyXDER3o7AMPh6P6EAAPwx/rkyLtboU7/
sn9ZBDkTzVLqD+b02bPYVfqB9y6sBqdSONpNokoMt3eY/D6pBhCmgrj/lqOYZIkn
o88Ec/7P001NYwxcjZC6gGQYBbTxrg/8eWe3neZwApRQU8E1D16QOtftxmgT2Cff
iMAr+ktIQyi0LPLI6TuyCoqoL0FWtohd9+vU3lQEQeyk7WPPO0ho2foHrt4MhH/b
T9STnJp/RcEDQxSnqRleGsQuEwmIlJRPmvLQF24X/n1oIauhkoO2p8NrdqFkkOGy
mUnugFEmuuMtAJaTHokMnVOgM5ULn1lvsgKVkQ5zuYQsLGTfbjQHQPjdFs94bSNg
cUxGguCaOCwAI+G6
-----END CERTIFICATE-----'
sudo echo "$keytext"  > /opt/bitnami/nginx/conf/bitnami/certs/server.key
sudo echo "$certtext" > /opt/bitnami/nginx/conf/bitnami/certs/server.crt
#
sudo /opt/bitnami/ctlscript.sh restart bitnami.nginx

